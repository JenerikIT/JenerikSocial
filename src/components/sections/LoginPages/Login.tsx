import { useForm } from "react-hook-form";
import "./login.scss";
import { ChangeEvent, useState } from "react";
import { useNavigate } from "react-router-dom";
import { useLoginMutation } from "../../../api/auth/authApi";
type FormData = {
  password: string;
};
function Login() {
  const {
    handleSubmit,
    formState: {},
  } = useForm<FormData>();
  const navigate = useNavigate();
  const [email, setValueEmail] = useState<string>("");
  const [password, setPassword] = useState<string>("");
  const [loginUser, {}] = useLoginMutation();
  const onChangeValueEmail = (e: ChangeEvent<HTMLInputElement>) => {
    setValueEmail(e.target.value);
  };
  const [serverError, setServerError] = useState<string | null>(null);
  const onSubmit = async () => {
    setServerError(null);
    try {
      const params = {
        password: password,
        email: email,
      };
      const response = await loginUser(params).unwrap();
      localStorage.setItem("token", response.token);
      navigate("/");
      console.log("Успех:", response);
    } catch (error: any) {
      console.error("Ошибка:", error);
      setServerError(error.data?.message || "Неверный логин или пароль");
    }
  };
  const [showPassword, setShowPassword] = useState(false);
  return (
    <form className="Login" onSubmit={handleSubmit(onSubmit)}>
      <div className="Login__container">
        <div className="Login__title">Вход</div>
        <div className="Login__group-input">
          <div
            className="Login__input"
            style={serverError ? { border: "1px solid #D70000" } : {}}
          >
            <input
              value={email}
              onChange={onChangeValueEmail}
              type="email"
              placeholder="Email"
            />
            {email.length > 4 && (
              <svg
                onClick={() => {
                  setValueEmail("");
                }}
                width="16"
                height="16"
                viewBox="0 0 16 16"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g clip-path="url(#clip0_3170_2389)">
                  <path
                    d="M16 8C16 10.1217 15.1571 12.1566 13.6569 13.6569C12.1566 15.1571 10.1217 16 8 16C5.87827 16 3.84344 15.1571 2.34315 13.6569C0.842855 12.1566 0 10.1217 0 8C0 5.87827 0.842855 3.84344 2.34315 2.34315C3.84344 0.842855 5.87827 0 8 0C10.1217 0 12.1566 0.842855 13.6569 2.34315C15.1571 3.84344 16 5.87827 16 8ZM5.354 4.646C5.26011 4.55211 5.13278 4.49937 5 4.49937C4.86722 4.49937 4.73989 4.55211 4.646 4.646C4.55211 4.73989 4.49937 4.86722 4.49937 5C4.49937 5.13278 4.55211 5.26011 4.646 5.354L7.293 8L4.646 10.646C4.59951 10.6925 4.56264 10.7477 4.53748 10.8084C4.51232 10.8692 4.49937 10.9343 4.49937 11C4.49937 11.0657 4.51232 11.1308 4.53748 11.1916C4.56264 11.2523 4.59951 11.3075 4.646 11.354C4.73989 11.4479 4.86722 11.5006 5 11.5006C5.06574 11.5006 5.13084 11.4877 5.19158 11.4625C5.25232 11.4374 5.30751 11.4005 5.354 11.354L8 8.707L10.646 11.354C10.6925 11.4005 10.7477 11.4374 10.8084 11.4625C10.8692 11.4877 10.9343 11.5006 11 11.5006C11.0657 11.5006 11.1308 11.4877 11.1916 11.4625C11.2523 11.4374 11.3075 11.4005 11.354 11.354C11.4005 11.3075 11.4374 11.2523 11.4625 11.1916C11.4877 11.1308 11.5006 11.0657 11.5006 11C11.5006 10.9343 11.4877 10.8692 11.4625 10.8084C11.4374 10.7477 11.4005 10.6925 11.354 10.646L8.707 8L11.354 5.354C11.4005 5.30751 11.4374 5.25232 11.4625 5.19158C11.4877 5.13084 11.5006 5.06574 11.5006 5C11.5006 4.93426 11.4877 4.86916 11.4625 4.80842C11.4374 4.74768 11.4005 4.69249 11.354 4.646C11.3075 4.59951 11.2523 4.56264 11.1916 4.53748C11.1308 4.51232 11.0657 4.49937 11 4.49937C10.9343 4.49937 10.8692 4.51232 10.8084 4.53748C10.7477 4.56264 10.6925 4.59951 10.646 4.646L8 7.293L5.354 4.646Z"
                    fill="#969696"
                  />
                </g>
                <defs>
                  <clipPath id="clip0_3170_2389">
                    <rect width="16" height="16" fill="white" />
                  </clipPath>
                </defs>
              </svg>
            )}
          </div>
          <div
            className="Login__input Login__input--password"
            style={serverError ? { border: "1px solid #D70000" } : {}}
          >
            <input
              value={password}
              onChange={(e: ChangeEvent<HTMLInputElement>) => {
                setPassword(e.target.value);
              }}
              type={!showPassword ? "password" : "text"}
              placeholder="Password"
            />
            {showPassword ? (
              <svg
                onClick={() => setShowPassword(false)}
                width="23"
                height="23"
                viewBox="0 0 25 25"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M12.5 15.625C14.2259 15.625 15.625 14.2259 15.625 12.5C15.625 10.7741 14.2259 9.375 12.5 9.375C10.7741 9.375 9.375 10.7741 9.375 12.5C9.375 14.2259 10.7741 15.625 12.5 15.625Z"
                  fill="#969696"
                />
                <path
                  d="M19.2783 6.89355C17.1436 5.42969 14.8589 4.6875 12.4883 4.6875C10.355 4.6875 8.27539 5.32227 6.30713 6.56641C4.32227 7.82373 2.37646 10.1074 0.78125 12.5C2.07129 14.6484 3.83594 16.8574 5.67383 18.124C7.78223 19.5762 10.0747 20.3125 12.4883 20.3125C14.8809 20.3125 17.1685 19.5767 19.29 18.1255C21.1577 16.8457 22.9351 14.6396 24.2188 12.5C22.9307 10.3794 21.1475 8.17578 19.2783 6.89355ZM12.5 17.1875C11.5729 17.1875 10.6666 16.9126 9.89576 16.3975C9.12491 15.8824 8.5241 15.1504 8.16932 14.2938C7.81453 13.4373 7.7217 12.4948 7.90257 11.5855C8.08344 10.6762 8.52988 9.841 9.18544 9.18544C9.841 8.52988 10.6762 8.08344 11.5855 7.90257C12.4948 7.7217 13.4373 7.81453 14.2938 8.16932C15.1504 8.5241 15.8824 9.12491 16.3975 9.89576C16.9126 10.6666 17.1875 11.5729 17.1875 12.5C17.1861 13.7428 16.6918 14.9342 15.813 15.813C14.9342 16.6918 13.7428 17.1861 12.5 17.1875V17.1875Z"
                  fill="#969696"
                />
              </svg>
            ) : (
              <svg
                onClick={() => setShowPassword(true)}
                width="23"
                height="23"
                viewBox="0 0 25 25"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M4.199 3.12509L3.12488 4.19922L20.8008 21.8752L21.8749 20.801L4.199 3.12509Z"
                  fill="#969696"
                />
                <path
                  d="M12.6631 9.37891L15.6206 12.3364C15.5795 11.5654 15.2547 10.8368 14.7087 10.2908C14.1628 9.74478 13.4341 9.41999 12.6631 9.37891V9.37891Z"
                  fill="#969696"
                />
                <path
                  d="M12.3369 15.6206L9.37939 12.6631C9.42048 13.4341 9.74527 14.1628 10.2913 14.7087C10.8372 15.2547 11.5659 15.5795 12.3369 15.6206Z"
                  fill="#969696"
                />
                <path
                  d="M12.5 17.1875C11.7789 17.1875 11.0675 17.0212 10.4211 16.7014C9.77475 16.3816 9.2109 15.917 8.77341 15.3438C8.33593 14.7705 8.0366 14.104 7.89873 13.3962C7.76086 12.6883 7.78817 11.9583 7.97852 11.2627L4.60596 7.88965C3.22852 9.15137 1.91602 10.7979 0.78125 12.5C2.07129 14.6484 3.83594 16.8574 5.67383 18.124C7.78223 19.5762 10.0747 20.3125 12.4883 20.3125C13.8073 20.3134 15.1164 20.0854 16.3574 19.6387L13.7397 17.0215C13.3358 17.132 12.9188 17.1879 12.5 17.1875V17.1875Z"
                  fill="#969696"
                />
                <path
                  d="M12.5 7.8125C13.2211 7.81246 13.9325 7.97881 14.5789 8.2986C15.2252 8.61838 15.7891 9.08298 16.2266 9.65625C16.6641 10.2295 16.9634 10.896 17.1013 11.6038C17.2391 12.3117 17.2118 13.0417 17.0215 13.7373L20.4717 17.1875C21.895 15.9058 23.2095 14.1816 24.2188 12.5C22.9307 10.3794 21.1475 8.17578 19.2783 6.89355C17.1436 5.42969 14.8589 4.6875 12.4883 4.6875C11.1838 4.68937 9.89029 4.92571 8.66943 5.38525L11.2627 7.97852C11.6659 7.86817 12.082 7.81233 12.5 7.8125V7.8125Z"
                  fill="#969696"
                />
              </svg>
            )}
          </div>
          {serverError && (
            <span className="register__error" style={{ color: "red" }}>
              Неправильный логин или пароль
            </span>
          )}
        </div>
        <button className="Login__button">Войти</button>

        <div className="Login__options">
          <div className="Login__remember">
            <input type="checkbox" id="remember" />
            <label htmlFor="remember">Remember me</label>
          </div>
          <a href="#" className="Login__forgot">
            Забыли пароль?
          </a>
        </div>

        <div className="Login__divider">
          <span className="Login__divider-line"></span>
          <span className="Login__divider-text">or</span>
          <span className="Login__divider-line"></span>
        </div>

        <div className="Login__social">
          <button className="register__social-button">
            <svg
              width="55"
              height="56"
              viewBox="0 0 55 56"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M0 28C0 12.8122 12.3122 0.5 27.5 0.5C42.6878 0.5 55 12.8122 55 28C55 43.1878 42.6878 55.5 27.5 55.5C12.3122 55.5 0 43.1878 0 28Z"
                fill="white"
              />
              <path
                d="M27 21.2533C29.0656 21.2533 30.4589 22.1456 31.2533 22.8911L34.3578 19.86C32.4511 18.0878 29.97 17 27 17C22.6978 17 18.9822 19.4689 17.1733 23.0622L20.73 25.8244C21.6222 23.1722 24.0911 21.2533 27 21.2533Z"
                fill="#EA4335"
              />
              <path
                d="M37.56 28.2462C37.56 27.3418 37.4867 26.6818 37.3278 25.9973H27V30.0795H33.0622C32.94 31.094 32.28 32.6218 30.8133 33.6484L34.2844 36.3373C36.3622 34.4184 37.56 31.5951 37.56 28.2462Z"
                fill="#4285F4"
              />
              <path
                d="M20.7422 30.1775C20.51 29.4931 20.3756 28.7598 20.3756 28.002C20.3756 27.2442 20.51 26.5109 20.73 25.8264L17.1733 23.0642C16.4278 24.5553 16 26.2298 16 28.002C16 29.7742 16.4278 31.4487 17.1733 32.9398L20.7422 30.1775Z"
                fill="#FBBC05"
              />
              <path
                d="M27 38.999C29.97 38.999 32.4633 38.0212 34.2844 36.3346L30.8133 33.6457C29.8844 34.2934 28.6378 34.7457 27 34.7457C24.0911 34.7457 21.6222 32.8268 20.7422 30.1746L17.1855 32.9368C18.9944 36.5301 22.6978 38.999 27 38.999Z"
                fill="#34A853"
              />
            </svg>
          </button>
          <button className="register__social-button" type="submit">
            <svg
              width="55"
              height="55"
              viewBox="0 0 55 55"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M0 27.5C0 12.3122 12.3122 0 27.5 0C42.6878 0 55 12.3122 55 27.5C55 42.6878 42.6878 55 27.5 55C12.3122 55 0 42.6878 0 27.5Z"
                fill="#4680C2"
              />
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M23.2664 15.95H30.634C37.3581 15.95 38.9502 17.542 38.9502 24.2661V31.6338C38.9502 38.3579 37.3581 39.95 30.634 39.95H23.2664C16.5423 39.95 14.9502 38.3579 14.9502 31.6338V24.2661C14.9502 17.542 16.5423 15.95 23.2664 15.95Z"
                fill="white"
              />
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M34.597 24.2154C34.7156 23.8427 34.597 23.5717 34.072 23.5717H32.3275C31.8871 23.5717 31.6839 23.8089 31.5653 24.0629C31.5653 24.0629 30.6676 26.2309 29.4143 27.6367C29.0078 28.0432 28.8215 28.1787 28.6013 28.1787C28.4827 28.1787 28.3303 28.0432 28.3303 27.6705V24.1984C28.3303 23.7581 28.1948 23.5548 27.8222 23.5548H25.0783C24.8074 23.5548 24.638 23.7581 24.638 23.9613C24.638 24.3847 25.2647 24.4864 25.3324 25.672V28.2464C25.3324 28.8053 25.2308 28.907 25.0106 28.907C24.4178 28.907 22.9781 26.7221 22.1143 24.2323C21.945 23.7411 21.7756 23.5548 21.3352 23.5548H19.5738C19.0656 23.5548 18.981 23.7919 18.981 24.046C18.981 24.5033 19.5738 26.8067 21.7417 29.8554C23.1814 31.9387 25.2308 33.0566 27.0769 33.0566C28.1948 33.0566 28.3303 32.8025 28.3303 32.3791V30.8039C28.3303 30.2958 28.4319 30.2111 28.7876 30.2111C29.0416 30.2111 29.499 30.3466 30.5321 31.3459C31.7177 32.5315 31.921 33.0735 32.5815 33.0735H34.3261C34.8342 33.0735 35.0713 32.8195 34.9358 32.3283C34.7834 31.8371 34.2075 31.1257 33.4623 30.2789C33.0558 29.8046 32.446 29.2796 32.2597 29.0255C32.0057 28.6868 32.0734 28.5513 32.2597 28.2464C32.2428 28.2464 34.3769 25.2316 34.597 24.2154Z"
                fill="#4680C2"
              />
            </svg>
          </button>
        </div>

        <div className="Login__footer">
          У вас нет аккаунта?
          <a
            href="#"
            className="Login__link"
            onClick={() => {
              navigate("/register");
            }}
          >
            Зарегистрироваться
          </a>
        </div>
      </div>
    </form>
  );
}

export default Login;
